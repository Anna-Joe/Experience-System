## PSASP文件阅读笔记

![](D:\tasks\task8psasp文件\psasp读写过程.png)

### 写入psaspDocument

在psasp_memdb中load函数读取。分为 

（算例，厂站，母线，母线编号，线路/容抗器，绕组，直流线路，发电机，负荷，分区，柔性直流，

暂态设置，暂态母线编号，暂态交流线路，暂态绕组，暂态直流线路，暂态发电机，暂态负荷，暂态静止无功补偿器，暂态网络故障，暂态扰动，暂态稳定分析判据，

短路功能设置，短路条件设置）

二十五个函数（母线信息通过两个函数分别读取）分别读取二十四个不同的文件。读取方式为textSource类下的readLine函数，按行读取。

| 数据                         | 数据来源（文件名） | 文件描述                                                     | 数据读取细节                                                 |
| :--------------------------- | :----------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 算例Case                     | LF.L0              | <u>潮流作业定义（共三行数据）</u> （第一行）母线数、交流线路数、变压器绕组数、直流线路数、发电机数、负荷数、区域功率控制有效标记1、控制和UD功能1、未知、变电站数据有效标记、发电负荷比例因子标记、（第二行）基准容量、电压上限标幺值、电压下限标幺值、允许计算误差、计算方法选择、最大迭代次数、区域功率控制有效标记2、控制和UD功能2、预设平衡点和读取上次潮流值标记、变电站数据有效标记2、未知、考虑变压器激磁阻抗标记、MATLAB接口有效标记、（第三行）潮流作业编号、潮流作业名称 |                                                              |
| 厂站Station                  | LF.PSTATION        | <u>厂站</u>  厂站编号 、分区、第三列未知 、厂站名称          |                                                              |
| 母线 Bus,BusNode             | LF.L1              | <u>母线信息</u> 母线名称、基准电压、所属分区、最高电压、最低电压、单相短路容量、三相短路容量（母线编号为LF.L1卡的行号） | **为什么要单独生成一个母线编号表？是不是为了方便loadLineWise函数使用** |
| 母线编号 BusNode_PHYBUS_LFI  | PHYBUS.LFI         | 有效标识、母线名称、母线编号                                 |                                                              |
| 线路，容抗器 ACLine          | LF.L2              | <u>交流线路</u> 投运状态（**是不是就是有效标记**）、线路首端母线节点在LF.L1卡的行号、线路末端母线节点在LF.L1表中的行号、线路名称后的编号、正序电阻标幺值、正序电抗标幺值、正序电纳标幺值、所属分区、线路控制功能类型、控制参数组号、第十一列未知、第十二列未知、被控量的给定值、额定容量（kA）、容量上限百分比、被控节点名、被控元件编号、线路名称。 | 表结构和卡结构不同。函数中调用了**loadLineWise**(textSource, table, fmt, fields)函数进行特殊处理，猜测是通过第二第三列的数据去母线表里面读数据了。具体的还没看懂。。 |
| 绕组 Winding                 | LF.L3              | <u>变压器绕组</u> 投运状态（**怀疑就是有效标记**）、主变一侧母线节点在LF.L1卡的行号（三圈变行号前面多了“-”号以便区分三圈与两圈） 、另一侧母线节点在LF.L1卡的行号、主变各侧编号、正序电阻标幺值、正序电抗标幺值、各侧标准变比、激磁电阻 、激磁电抗 、第十列未知、控制类型、控制元件组号、第十三列未知、第十四列未知、第十五列未知、被控量设定值、给定相角值、各侧额定容量、容量上限百分比、表内顺序编号、第二十一列未知、绕组类型、被控元件名、被控元件类型、主变绕组名称、第二十六列未知、各侧电压等级、最高档位1、最低档位1、主抽头档位1、电压步长1、第三十二列未知。 | loadLineWise(textSource, table, fmt, fields)                 |
| 直流线路 DCLine              | LF.L4              | <u>直流线路（共四行数据）</u>（第一行）是否投运、整流侧母线、逆变侧母线、线路编号、整流侧接地引线电阻、整流侧接地引线电感、逆变侧接地引线电阻、逆变侧接地引线电感、直流线路电阻、直流线路电感、描述信息、（第二行）接地极整流侧和逆变侧电阻、未知、未知、单极整流侧和逆变侧平波电抗器电感、（第三行）整流侧换流变交流侧主抽头额定线电压、整流侧换流变阀侧出口额定线电压、整流侧每极换流桥数、整流侧换流变接入补偿电容器滤波单极容量、整流侧换流变单极总容量、整流侧换流变压器铜损电阻值、整流侧换流变压器漏抗百分数、整流侧换流变压器最高抽头线电压、整流侧换流变压器最低抽头线电压、整流侧换流变压器抽头级数、（第四行）逆变侧换流变交流侧主抽头额定线电压、逆变侧换流变阀侧出口额定线电压、逆变侧每极换流桥数、逆变侧换流变接入补偿电容器滤波单极容量、逆变侧换流变单极总容量、逆变侧换流变压器铜损电阻值、逆变侧换流变压器漏抗百分数、逆变侧换流变压器最高抽头线电压、逆变侧换流变压器最低抽头线电压、逆变侧换流变压器抽头级数、（第五行）直流运行方式、单极运行电流、单极额定电压、单极最小点燃角、单极点燃角、单极最小熄弧角、单极熄弧角、分区编号。 | loadMultiLines(textSource, table, fmt, fields);              |
| 发电机 Gen                   | LF.L5              | <u>发电机组</u> 投运状态、机组母线节点在LF.L1卡的行号、发电机类型、发电机有功功率标幺值、发电机无功功率标幺值、发电机母线电压标幺值、发电机母线电压相角、发电机无功上限标幺值、发电机无功下限标幺值、发电机有功上限标幺值、发电机有下限标幺值、控制参数组号、第十三列未知、第十四列未知、控量给定值、第十六列未知、被控元件名、被控元件编号、发电机名称。 | loadLineWise(textSource, table, fmt, fields);                |
| 负荷 Load                    | LF.L6              | <u>负荷</u> 投运状态、**所挂母线节点编号(表里记录的表头数据是母线busname）**、负荷编号、负荷类型、**负荷有功功率标幺值（有功功率实际值）**、**负荷无功功率标幺值（无功功率实际值）**、**负荷母线电压标幺值（节点电压幅值）**、**负荷母线电压相角（节点电压相角）**、**负荷无功上限标幺值（无功上限）**、**负荷无功下限标幺值（无功下限）**、**负荷有功上限标幺值（有功上限）、负荷有功下限标幺值（有功下限）**、控制参数组号、负荷模型、负荷参数组号、被控量给定值、被控元件名、被控元件编号、负荷名称。 | loadLineWise(textSource, table, fmt, fields);                |
| 分区 Area                    | LF.L7              | <u>分区信息</u> 有效标记、分区编号、分区名称、第四列未知、第五列未知、第六列未知、第七列未知。 | loadLineWise(textSource, table);                             |
| 柔性直流 Vsc                 | LF.ML4             |                                                              | 表头信息和数据信息都包含在文件中可以直接读到                 |
| 暂态设置 STSetting           | ST.S0              | <u>暂态故障集设置（共两行数据）</u>（第一行）ST.S1表中母线总数、ST.S2交流线路总数、DEV.XFRM卡中所有主变的（包括换流站主变）绕组数（三圈变三个，两圈变一个）、ST.S4直流线路数、ST.S5发电机总行数、ST.S6负荷总个数、ST.S7静止无功补偿器个数、网络故障数量、有效节点扰动数量、第十列未知 、第十一列未知 、第十二列未知、（第二行）第十三列未知、计算总时间、积分步长、第十六列未知、第十七列未知、第十八列未知、系统频率（0为50HZ，1为60HZ）、 第二十列未知、第二十一列未知、第二十二列未知、第二十三列未知、第二十四列未知、第二十五列未知、允许误差、第二十七列未知、作业名、第二十九列未知、滤波时间常数 | loadMultiLines(textSource, table)                            |
| 暂态母线编号 STBusNode       | ST.S1              | <u>母线名称及其行号</u>  （按PHYBUS.LFI的格式写表）有效标记，母线名，母线编号 |                                                              |
| 暂态交流线路 STACLine        | ST.S2              | <u>交流线路&电容器&电抗器&零序负荷</u>     投运状态、线路首端母线节点在ST.S1表中的行号、线路末端母线节点在ST.S1表中的行号、线路名称后的编号、零序电阻标幺值、零序电抗标幺值、零序电纳标幺值、线路名称 | loadLineWise(textSource, table, fmt, fields)                 |
| 暂态绕组 STWinding           | ST.S3              | <u>变压器</u>  投运状态、主变一侧节点在ST.S1表中的行号、 主变另一侧节点在ST.S1表中的行号 （三圈变为何两侧均为中心点）、主变编号（三圈变各侧都有，两圈变只有一个）、正序电阻标幺值、正序电抗标幺值、各侧标准变比、第八列未知 、第九列未知 、描述 | loadLineWise(textSource, table)                              |
| 暂态直流线路 STDCLine        | ST.S4              | <u>直流线路相关参数（共四行数据，有时候有五行）</u>（第一行）有效标记、整流侧母线、逆变侧母线、字段4、5、6、7、8、9、10、11未知、描述、第二三四行数据全部未知 |                                                              |
| 暂态发电机 STGen             | ST.S5              | <u>发电机组参数</u>  是否投运、发电机母线节点在ST.S1表中的行号、第三列未知、第四列未知、第五列未知、第六列未知、第七列未知、第八列未知、第九列未知、第十列未知、暂态电抗Xd’、次暂态电抗Xd’’ 、负序电抗X2、第十四列未知、第十五列未知、第十六列未知、发电机名称 | loadLineWise(textSource, table)                              |
| 暂态负荷 STLoad              | ST.S6              | <u>负荷</u> 是否投运、负荷所挂母线节点在ST.S1表中的行号、负荷编号、负荷模型、负荷参数组号、恒定阻抗、描述。 | loadLineWise(textSource, table)                              |
| 暂态静止无功补偿器 STSVC     | ST.S7              | <u>静止无功补偿器相关信息</u> 有效标记、字段2、3、4、5、6、7、8、9、10、11、12、13未知、描述 | loadLineWise(textSource, table)                              |
| 暂态网络故障 STFault         | ST.S11             | <u>暂态网络故障生成卡</u>**（每一行是一个故障卡）**故障是否有效（0无效，1有效）、故障支路首端节点编号（ST.S1）、故障支路末端节点编号（ST.S1）、支路编号（ST.S2第四列）、故障点位置百分比、故障点新增母线（ST.S1）编号（通过设置故障点百分比会自动在ST.S1卡中添加一条母线同时ST.S0卡相应数值发生改变） 、 是否A相故障、是否B相故障 、是否C相故障、是否短路接地 、是否短路 、是否断线 、故障起始时间、故障结束时间、接入电阻、接入电抗 | loadLineWise(textSource, table)                              |
| 暂态扰动 STNodeDisturb       | ST.S12             | <u>节点扰动信息</u> 有效标记、首端节点编号、末端节点编号、支路编号、节点扰动类型编号、判别类型、开始时间、结束时间、判别值、第十字段未知、延迟时间、第十二字段未知 | loadLineWise(textSource, table)                              |
| 暂态稳定分析判据 STCriterion | STCRIT.DAT         | 第一字段未知、最大公角差、最低电压、最低电压持续时间、最低频率、最低频率持续时间、第七字段第八字段未知、功角差、电压峰峰值、第十一第十二字段未知 | loadLineWise(textSource, table)                              |
| 短路功能设置 SCFunction      | ST.SCC             | <u>短路计算计算功能设置卡</u>  短路计算为0/戴维南等值计算为1、基于方案为0/基于潮流为非零39为潮流文件编号、简单故障为0/复杂故障为1、故障类型（三相短路为1；单相接地为2；两相短路为3；两相接地短路为4）、第567字段未知、是否快速扫描即只计算故障点短路电流（是为1否为0）、是否计算直流多馈入短路比（是为1否为0） | loadLineWise(textSource, table)                              |
| 短路条件设置 SCCondition     | ST.SCCDATE         | <u>短路计算计算条件选择设置卡</u>    是否考虑电压系数C、是否不考虑并联电容器、是否不考虑并联电抗器、是否忽略支路电阻、是否忽略变压器非标准变化、是否不考虑交流线对地电容、是否不考虑串联电容器、是否考虑负荷、是否选PSASP基本计算方法、是否考虑继电保护整定规则条件、是否考虑国家短路计算标准条件、电压系数C的值、？、？、计算开断电流时间、？、？、？、是否考虑负荷为恒阻抗、是否只考虑负荷中的感应电动机部分 | loadLineWise(textSource, table)                              |

**loadLineWise和loadMutiLines实现的功能，他们的区别？？**

```c++
/*!
 * \brief 对于每行一条记录的表，调用该函数。
 *
 * \param src 文本数据源
 * \param table 目标表
 * \param fmt 各记录 RDFID 的格式
 * \param fields fmt 中所需的域
 *
 * \note fields 的大小应与 fmt 中的格式限定符个数相同。
 */
bool	loadLineWise	(ZTextSource &src, ZETable *table, const ZString &fmt = ZString(), const std::vector<int> &fields = std::vector<int>());

/*!
 * \brief 对于一条记录分多行显示的表，调用该函数。
 *
 * \todo PSASP 的有些文件既可能是按行的，也可能是多行一条记录的（且分行的位置不固定）。可能可以将全部文件均按 loadMultiLines() 处理，
 *       此时对于按行的数据，依然可以正常匹配和对应。（待验证）
 */
bool	loadMultiLines	(ZTextSource &src, ZETable *table, const ZString &fmt = ZString(), const std::vector<int> &fields = std::vector<int>());

```



### 适配到ZSystem

主要通过十个函数适配ZSystem的数据。

| newPSASP_Adapter::readNet函数调用 | newPSASP_MemDb的接口（表名）   | 适配ZSystem的对象                                            | 说明                                                         |
| :-------------------------------- | ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| getbusNameIdMap()                 | "母线编号"                     |                                                              | 获取母线编号名称对照表                                       |
| getAreaNameIdMap()                | "分区"                         |                                                              | 获取分区编号名称对照表                                       |
| AddCase(system)                   | "算例"                         | system.setBaseMva<br />ZBusbar::s_DefVmax<br />ZBusbar::s_DefVmin | 设置基准功率、母线的默认电压上下限                           |
| addBusbar(system)                 | "母线"                         | system.addBusbar( zBusbar)、system.setArea(zNode,eRecord->value(areaIdField),areaName)、system.setZone(zNode,eRecord->value(areaIdField),areaName) | 适配母线信息 由于PASAP模型的特性，先把模型里的模型里的母线全部生成节点，这个顺序要保持，否则其他节点生成时会有问题 |
| AddACLine(system)                 | "交流线路"                     | system.addBranch(pLine)                                      | 适配支路信息                                                 |
| addGen(system)                    | "电源"                         | system.addGen(zGen)                                          | 适配发电机信息                                               |
| AddWinding(system)                | "绕组"                         | system.addBranch(pWinding)                                   | 适配支路信息**（支路可能有两部分？直流线路和绕组都算支路信息？）** |
| AddLoads(system)                  | "负荷"                         | system.addLoad(zload)、system.addGen(zGen)                   | **为什么负荷里还有发电机的数据？？**                         |
| treateDCSystem( system)           | 涉及多个表的处理（具体见下表） |                                                              | 处理直流系统中的一些问题                                     |
| addCap(system)                    | "并联补偿器组"                 | system.addCap(zcap)                                          | 适配并联补偿器组信息**（加载文件的时候好像没有读到这个信息吧？）** |



- treateDCSystem( system)内容

  | newPSASP_Adapter::<br />treateDCSystem函数调用 | newPSASP_MemDb的接口（表名）                       | 适配ZSystem的对象                                            | 说明                                                 |
  | ---------------------------------------------- | -------------------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------------- |
  | modifyDcNodeType()                             | /                                                  | /                                                            | 修改直流节点类型，但暂时不需要，因此函数为空         |
  | treateVsConverter()                            | "VSC#2"母线表、"VSC#3"VSC换流表、"VSC#5"直流线路表 | system.addBranch、(converter);                               | 处理VSC换流器                                        |
  | treateEqualLcc()                               | /                                                  | /                                                            | 等值方式处理暂时保留，但不用                         |
  | treateVscLccDclineSegment()                    | "VSC#5"直流线路表                                  | system.addBranch、(dcLineSegment);                           | 处理直流线路段，把上述两种换流器用直流线路段连接起来 |
  | treateDCLine()                                 | "直流线路"                                         | system.addBusbar( IDCbusabr)、system.setArea(IDCnode,eRecord->value(areaNoField),areaName);    //整流侧直流节点和母线、system.setZone(IDCnode,eRecord->value(areaNoField),areaName);    //整流侧直流节点和母线 | 处理传统直流线路                                     |

  