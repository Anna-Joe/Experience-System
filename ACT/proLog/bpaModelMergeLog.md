## 修复日志

### 广东-东莞模型拼接（3.0）

#### 1.文件问题

~~荣将1P<115.0> 母线 11879 115.000000000000 busbar_荣将1P<115.0>~~

荣将节点应该是线路里面存的末端节点名称有问题，被当成孤立节点删除了 

修改了文件里线路的空格 已解决



#### 2.修改主变中性点筛选条件，必须为内网里已有节点

- 问题：~~DANGZAI0<110.0> 母线 1953 110.000000000000 busbar_DANGZAI0<110.0>~~

  ​		~~YACHONG0<110.0> 母线 7699 110.000000000000 busbar_YACHONG0<110.0>~~

  ​		这两个都是主变的中性点 

- 解决：修改了筛选中性点的条件 必须为内网里有的节点

- 链接：

  ```
  ZNewBpaMergeDialog::setNodeRdfIdByArea:
  ...
      	m_allInnerNodeList << rdfId;
  ...
  ```

  

#### 3.修改内网节点直连主变的循环条件

（变化的内网节点列表》》固定的内网节点列表）是否已有该节点

- 问题：~~GD07-POS GD07-NEG~~

  在模型拼接之后的文件里表现不一致（外网里都是BD卡 内网里都是BG卡 拼接结果一个BD卡一个BG卡）

- 解决：修改了筛选内网节点直连主变的循环条件

- 链接：

  ```C++
  ZNewBpaMergeDialog::setNodeRdfIdByArea:
  ...
      ZStringList inNodeList = m_inNodeList;
  ...
  ```

- 遗留问题：GNG-POS GNG-NEG

  但是关于BG卡和BD卡的转换 在模型拼接中并没有处理



#### 4.修改PZ卡的拼接，增加对内网文件分区的匹配

- 问题： 拆分PZ卡的时候 分区选择的是参数库里的分区 如果参数库里的分区在内网文件中没有 那么拼接结果中会缺少PZ卡

- 解决：将界面上选择的分区传递到了splitter里面 已解决

- 链接：

  ```
  ZBpaMerger::setInternalOwners
  ZBpaSplitter::setInternalBpaPZtable
  ```

  

#### 5.统一拆分内外网支路的约束条件，去重拼接结果中的线路和绕组

- 问题：~~线路重复~~

- 解决：修改了拆分支路中拆分线路的部分 拆分内网支路与拆分外网支路的拆分条件不同 统一拆分条件之后 解决了线路重复问题

- 链接：

  ```
  ZBpaSplitter::splitBpaBranchByTransNodes
  ```

  

- 问题：绕组重复（与线路重复类似）

  修改只要线路一端是内网节点就算内网线路之后 绕组缺失

  - 缺失的绕组： 

    BA-HLZ525  BAOAN=500

    DCMUMIA=500 GD04-HLZ

    DCSUID=500 GD01-HLZ 500 1/2/3（有三个绕组）

- 链接：

  ```
  ZBpaSplitter::splitBpaBranchByTransNodes
  ```



#### 总结-判定内网节点的四个条件：

- 内网文件中，所选分区内的节点
- 内网文件中，内网节点连接的绕组的另一端节点
- 内网文件中，变压器的中性点
- 外网文件中，边界节点的中性点（在内网文件中存在）

判定边界节点的条件：

- 内网文件中，内网节点连接的线路的另一端节点

### 广东-东莞模型拼接二次修改（3.0）

#### 6.修改为使用原有逻辑的“按分区拼接”，并作适配工作

- 一次移植的时候使用的是按所有者拼接



### 浙江-地调模型拼接（3.0/2.0同步修改）

#### 1.增加对浙江地调地区边界节点的处理

- 非地调地区模型拼接时会将边界节点加入内网节点
- 低调地区 边界节点与内网节点无包含关系

#### 2.2.0代码中对于中性点的处理进行了简化

- 仅作第六位是否为B的判断





### 浙江-宁波模型拼接（2.0）

#### 1.增加对PSDB导出的外网文件的处理

- 问题：PSDB导出的文件和智能计算参数库导出的文件中性点电压不同，导致无法通过主变中性点匹配内外网的主变

- 解决：按参数库中性点电压导出规则（220以上的厂站取中压侧母线电压，220及以下厂站取高压侧母线电压），对外网文件中**含有内网标志**的中性点电压进行修改。（修改BPA中所有节点表和支路表中涉及中性点的电压，基准电压和额定电压都需要修改）

- 链接：

  ```
  ZBpaMergeDialog::dealPSDBCenterNodeBaseKv
  ```



#### 2.增加对拼接之后的模型进行孤立节点的处理

- 问题：拼接之后文件中含多个孤立节点

- 解决：删除孤立节点

- 链接：

  ```
  ZBpaMerger::removeUnusedNodes
  ```

  

#### 2.增加对外网边界双绕组主变的处理

- 问题：内网节点所连的双绕组，在外网中也存在时，需要删除外网中的记录

- 解决：在对内网文件的绕组筛选时，加入新的约束条件，双绕组两端不是一个边界节点一个内网节点的情况下，删除

- 链接：

  ```
  ZBpaSplitter::splitBpaBranchByNodes
  ...
  			if(isWinding && ((!frAtVerge && !toInner) || (!toAtVerge && !frInner)))
  				continue;
  ...
  ```

  

#### 3.增加对边界三绕组主变的处理

- 问题：三绕组主变的中低压侧在内网已经分裂成多个母线，与外网文件中低压侧不同，此时应该删除外网的旧记录，而因为内网文件中无此对应记录，原有逻辑会保留外网的旧纪录。

- 解决：将内网绕组中低压侧传入外网文件的处理过程中，中低压绕组不含的记录，在外网文件中删除。

- 链接：

  ```
  ZBpaSplitter::splitBpaBranchByTransNodes
  ...
  	const ZStringList& tranMidLowBusList
  ```



#### 4.宁波特有处理

- 问题：对于所有者为N（认为是外网节点）的节点，应取220以上的节点为外网节点，220及以下的节点为内网节点保证内网的主变正常处理

- 解决：在对内网节点V1的筛选过程中，添加条件：所有者为N的节点&&220以下节点为内网节点

- 链接：

  ```
  ZBpaMergeDialog::setNodeRdfIdByArea
  ...
  			else if(innerSymbol.trimmed() == "N" && baseKv <= 230)
  			{
  				m_warnings << QString("内网节点：") + rdfId/* + QString(" 内网标志：") + innerSymbol*/;
  				m_inNodeList << rdfId;
  			}
  
  ```



